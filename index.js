"use strict";var cheerio=require("cheerio"),axios=require("axios"),fs=require("fs/promises");class PSXSerial{constructor(){this.client=axios.create({baseURL:"http://redump.org"}),this.volume={createdAt:(new Date).toISOString(),serials:[]}}async run(){console.log("Starting PSX Serial fetch operation...");var t=await this.getMaxPage();console.log("Max page: "+t);for(let e=0;e<t;e++)console.log(`Fetching page ${e+1}...`),this.volume.serials=[...this.volume.serials,...await this.getSerialsFrom(e)];return console.log("Serials fetched! Writing out to disk..."),await this.writeSerials(),this.volume}async getSerialsFrom(e){const n=await this.getSerialPage(e);return n("table.games tbody").find("tr:not(.th)").toArray().map(e=>{var t=((n(e).find("td:eq(6)").attr("title")||n(e).find("td:eq(6)").text())?.split(", ")).map(e=>e.trim().replace("#","").replace(/\s/g,"-")),i=n(e).find("td:eq(0) > img").attr("title"),a={kanji:n(e).find("td:eq(1) > a span").text()||null,occidental:n(e).find("td:eq(1) > a")?.html()?.replace(/<br.*>/gi,"")?.replaceAll("&amp;","&")},r=n(e).find("td:eq(2)").text().trim(),s=n(e).find("td:eq(3)").text().trim(),l=n(e).find("td:eq(4)").text().trim(),e=n(e).find("td:eq(5) img").toArray().map(e=>n(e).attr("title")),t=Array.from(new Set(t).values());return{region:i,title:a,system:r.toLowerCase(),version:s,edition:l,languages:e,serial:t}})}async getSerialPage(e){return this.getHTMLPage("/discs/system/psx/?page="+e)}async getMaxPage(){return this.getHTMLPage("/discs/system/psx/").then(e=>+e("div.pages li:last-child").text())}async getHTMLPage(e){e=(await this.client.get(e,{transformResponse:e=>cheerio.load(e)})).data;return e}writeSerials(){return fs.writeFile("serials.json",JSON.stringify(this.volume),{encoding:"utf8",mode:"0777",flag:"w",flush:!0})}}(new PSXSerial).run();